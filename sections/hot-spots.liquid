{% assign spot_mobile_input_name = section.id | append: '-mobile-radio-group' %}

{% if section.settings.section_center_heading -%}
	{%- assign heading_align = 'center' -%}
{%- else -%}
	{%- assign heading_align = 'left' -%}
{%- endif %}
<div class="section-wrapper section-wrapper--y-offset--padding color-scheme-{{ section.settings.section_color_scheme.id }} {% if section.settings.section_center_heading %}section-wrapper--center-align{% endif %}">
	{% if section.settings.section_heading != blank or section.settings.section_description != blank %}
		<div class="container section-wrapper__header">
			<div class="content content--align--{{ heading_align }}">
				{% if section.settings.section_heading != blank %}
					<div class="content__heading">
						{% capture heading_capture %}
							<h2 class="heading heading--size--{{ section.settings.section_heading_size }}">
								{{ section.settings.section_heading }}
							</h2>
						{% endcapture %}
						{% if section.settings.section_heading_animation %}
							<div
								class="scroll-animation scroll-animation--use--text-reveal scroll-animation--origin-align--{{ heading_align }} {% unless settings.appearance_animate_heading_on_mobile %}scroll-animation--only-desktop-animation{% endunless %}"
								style=""
							>
								{{ heading_capture }}
							</div>
						{% else -%}
							{{- heading_capture -}}
						{%- endif %}
					</div>
				{% endif -%}
				{%- if section.settings.section_description != blank %}
					<div class="content__text">
						<p class="text text--size--md">{{ section.settings.section_description }}</p>
					</div>
				{% endif %}
			</div>
		</div>
	{% endif %}
	<div class="container section-wrapper__body">
		{% assign base_spot_color_diff = section.settings.spots_color | brightness_difference: '#ffffff' %}

		<x-hot-spots
			class="hot-spots"
			style="--hot-spots-spot-color: {{ section.settings.spots_color }};--hot-spots-spot-icon-color: {% if base_spot_color_diff > 125 %}#ffffff{% else %}#2d2d2d{% endif %};"
		>
			<div class="hot-spots__stage">
				<div data-hot-spots-element="image">
					<div
						class="banner banner--placerholder-ar"
						style="--banner-focal: {{ section.settings.image.presentation.focal_point }};"
					>
						{% if section.settings.image != blank %}
							<picture class="banner__image">
								<img
									src="{{ section.settings.image | image_url }}"
									alt="{{ section.settings.image.alt | escape }}"
									width="{{ section.settings.image.width }}"
									height="{{ section.settings.image.height }}"
									loading="lazy"
									data-img-loading
									onload="this.removeAttribute(&#34;data-img-loading&#34;)"
								>
							</picture>
						{%- endif %}

						{% unless section.settings.image -%}
							{{- 'lifestyle-1' | placeholder_svg_tag: 'banner__placeholder' }}
						{% endunless %}
					</div>
				</div>
				{% for block in section.blocks -%}
					{%- assign spot_id = 'spot-' | append: section.id | append: block.id -%}
					{%- assign spot_id_mobile = spot_id | append: '-mobile' -%}
					{%- assign x_card_position = 'left' %}
					{% assign y_card_position = 'top' %}

					{% if block.settings.x_position > 33 and block.settings.x_position <= 67 -%}
						{%- assign x_card_position = 'center' -%}
					{%- endif %}

					{% if block.settings.y_position > 33 and block.settings.y_position <= 67 -%}
						{%- assign y_card_position = 'center' -%}
					{%- endif %}

					{% if block.settings.x_position > 67 %}{% assign x_card_position = 'right' %}{% endif %}

					{% if block.settings.y_position > 67 %}{% assign y_card_position = 'bottom' %}{% endif %}

					<div
						class="hot-spots__spot"
						style="--hot-spots-spot-x-position: {{ block.settings.x_position }};--hot-spots-spot-y-position: {{ block.settings.y_position }};"
						{{ block.shopify_attributes }}
					>
						<div class="hot-spots__spot__control">
							<label class="hot-spots__spot__label" for="{{ spot_id_mobile }}"></label>
							<label class="hot-spots__spot__label mobile-hidden" for="{{ spot_id }}">
								<svg>
									<use  xlink:href="#svg-icon-plus"></use>
								</svg>
							</label>

							<div class="mobile-hidden">
								<input class="hot-spots__spot__input" type="checkbox" id="{{ spot_id }}" hidden data-spot-trigger>

								<div class="hot-spots__spot__card hot-spots__spot__card--position--{{ y_card_position }}-{{ x_card_position }} color-scheme-{{ section.settings.cards_color_scheme.id }}">
									<div class="hot-spots__card-body">
										<div class="hot-spots__card-body__inner">
											{% if block.settings.image != blank %}
												<div class="hot-spots__card-body__image">
													<picture>
														<source srcset="{{ block.settings.image | image_url: width: 70 }} 1x, {{ block.settings.image | image_url: width: 140 }} 2x, {{ block.settings.image | image_url: width: 210 }} 3x">

														<img
															src="{{ block.settings.image | image_url }}"
															alt="{{ block.settings.image.alt | escape }}"
															width="{{ block.settings.image.width }}"
															height="{{ block.settings.image.height }}"
															loading="lazy"
															data-img-loading
															onload="this.removeAttribute(&#34;data-img-loading&#34;)"
														>
													</picture>
												</div>
											{% endif %}

											<div class="hot-spots__card-body__info">
												{% if block.settings.heading != blank %}
													<h5 class="hot-spots__card-body__title">{{ block.settings.heading }}</h5>
												{% endif %}

												{% if block.settings.text != blank %}
													<p class="hot-spots__card-body__text">{{ block.settings.text }}</p>
												{% endif %}
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					{% capture capture_mobile_cards -%}
						{{- capture_mobile_cards }}
						<div class="hot-spots__card-body">
							<input type="radio" id="{{ spot_id_mobile }}" name="{{ spot_mobile_input_name }}" hidden>
							<div class="hot-spots__card-body__inner">
								{% if block.settings.image != blank %}
									<div class="hot-spots__card-body__image">
										<picture>
											<source srcset="{{ block.settings.image | image_url: width: 70 }} 1x, {{ block.settings.image | image_url: width: 140 }} 2x, {{ block.settings.image | image_url: width: 210 }} 3x">

											<img
												src="{{ block.settings.image | image_url }}"
												alt="{{ block.settings.image.alt | escape }}"
												width="{{ block.settings.image.width }}"
												height="{{ block.settings.image.height }}"
												loading="lazy"
												data-img-loading
												onload="this.removeAttribute(&#34;data-img-loading&#34;)"
											>
										</picture>
									</div>
								{% endif %}

								<div class="hot-spots__card-body__info">
									{% if block.settings.heading != blank %}
										<h5 class="hot-spots__card-body__title">{{ block.settings.heading }}</h5>
									{% endif %}

									{% if block.settings.text != blank %}
										<p class="hot-spots__card-body__text">{{ block.settings.text }}</p>
									{% endif %}
								</div>
							</div>
						</div>
					{% endcapture -%}
				{%- endfor %}
			</div>
			<div class="hot-spots__mobile-cards desktop-hidden color-scheme-{{ section.settings.cards_color_scheme.id }}">
				{{ capture_mobile_cards }}
			</div>
		</x-hot-spots>
		<script type="module" src="{{ 'component-hot-spots.js' | asset_url }}"></script>
	</div>
</div>

{% schema %}
	{
		"name": "Hot spots",
		"class": "hot-spots-section",
		"presets": [
			{
				"name": "Hot spots",
				"blocks": [
					{
						"type": "card"
					}
				],
				"category": "Banners"
			}
		],
		"disabled_on": {
			"templates": ["password"],
			"groups": ["header", "custom.overlay"]
		},
		"settings": [
			{
				"type": "image_picker",
				"id": "image",
				"label": "Image"
			},
			{
				"type": "header",
				"content": "Content"
			},
			{
				"type": "text",
				"id": "section_heading",
				"label": "Heading",
				"default": "Image hot spots"
			},
			{
				"type": "select",
				"id": "section_heading_size",
				"label": "Heading size",
				"options": [
					{
						"value": "h2",
						"label": "Small"
					},
					{
						"value": "h1",
						"label": "Medium"
					},
					{
						"value": "d3",
						"label": "Large"
					}
				],
				"default": "h1"
			},
			{
				"type": "checkbox",
				"id": "section_heading_animation",
				"label": "Use heading animation",
				"default": true
			},
			{
				"type": "checkbox",
				"id": "section_center_heading",
				"label": "Center heading",
				"default": true
			},
			{
				"type": "inline_richtext",
				"id": "section_description",
				"label": "Text"
			},
			{
				"type": "color_scheme",
				"id": "section_color_scheme",
				"label": "Color scheme",
				"default": "alt"
			},
			{
				"type": "color",
				"id": "spots_color",
				"label": "Dots color",
				"default": "#ffffff"
			},
			{
				"type": "color_scheme",
				"id": "cards_color_scheme",
				"label": "Cards color scheme",
				"default": "main"
			}
		],
		"blocks": [
			{
				"name": "Card",
				"type": "card",
				"settings": [
					{
						"type": "image_picker",
						"id": "image",
						"label": "Image",
						"info": "Optional. 100x100px recommended."
					},
					{
						"type": "text",
						"id": "heading",
						"label": "Heading",
						"default": "Card title"
					},
					{
						"type": "inline_richtext",
						"id": "text",
						"label": "Text",
						"default": "Give customers details about the banner image."
					},
					{
						"type": "header",
						"content": "Dot position"
					},
					{
						"type": "range",
						"id": "x_position",
						"min": 0,
						"max": 100,
						"step": 1,
						"unit": "%",
						"label": "Horizontal position",
						"default": 50,
						"info": "0% - left, 100% - right"
					},
					{
						"type": "range",
						"id": "y_position",
						"min": 0,
						"max": 100,
						"step": 1,
						"unit": "%",
						"label": "Vertical position",
						"default": 50,
						"info": "0% - top, 100% - bottom"
					}
				]
			}
		]
	}
{% endschema %}
