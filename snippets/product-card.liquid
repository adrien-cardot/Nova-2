{% if settings.product_card_image_crop -%}
	{%- assign contain_media = false -%}
{%- else -%}
	{%- assign contain_media = true -%}
{%- endif %}

{% if settings.product_card_card_style == 'normal' and contain_media -%}
	{%- assign outer_stage = false -%}
{%- else -%}
	{%- assign outer_stage = true -%}
{%- endif %}

{% if card_product.featured_image == null and settings.product_card_image_size == 'auto' -%}
	{%- assign media_size = 'square' -%}
{%- else -%}
	{%- assign media_size = settings.product_card_image_size -%}
{%- endif %}

{% capture capture_card_media -%}
	{%- if card_product.available == false %}
		<div class="badge color-scheme-{{ settings.colors_sold_out_color_scheme.id }} product-card__badge">
			{{ 'products.product.sold_out' | t }}
		</div>
	{% elsif card_product.compare_at_price > card_product.price and card_product.available %}
		<div class="badge color-scheme-{{ settings.colors_sale_color_scheme.id }} product-card__badge">
			{{ 'products.product.on_sale' | t }}
		</div>
	{% endif -%}
	{%- if card_product != blank %}
		<div
			class="banner banner--size--{{ media_size }} {% if contain_media %}banner--contain-media{% endif %}"
			style="--banner-focal: {{ card_product.featured_image.presentation.focal_point }};"
		>
			{% if card_product.featured_image != blank %}
				<picture class="banner__image">
					<source
						srcset="
							{% if card_product.featured_image.width >= 165 %}{{ card_product.featured_image | image_url: width: 165 }} 165w,{% endif %}
							{% if card_product.featured_image.width >= 360 %}{{ card_product.featured_image | image_url: width: 360 }} 360w,{% endif %}
							{% if card_product.featured_image.width >= 533 %}{{ card_product.featured_image | image_url: width: 533 }} 533w,{% endif %}
							{% if card_product.featured_image.width >= 720 %}{{ card_product.featured_image | image_url: width: 720 }} 720w,{% endif %}
							{% if card_product.featured_image.width >= 1000 %}{{ card_product.featured_image | image_url: width: 1000 }} 1000w,{% endif %}
							{% if card_product.featured_image.width >= 1500 %}{{ card_product.featured_image | image_url: width: 1500 }} 1500w,{% endif %}
							{{ card_product.featured_image | image_url }} {{ card_product.featured_image.width }}w
						"
						sizes="(min-width: 992px) 533px, (max-width: 992px) 72vw"
					>

					<img
						src="{{ card_product.featured_image | image_url }}"
						alt="{{ card_product.featured_image.alt | escape }}"
						width="{{ card_product.featured_image.width }}"
						height="{{ card_product.featured_image.height }}"
						loading="lazy"
						data-img-loading
						onload="this.removeAttribute(&#34;data-img-loading&#34;)"
					>
				</picture>
			{%- endif %}
		</div>
	{% else %}
		<div
			class="banner banner--size--{{ media_size }} {% if contain_media %}banner--contain-media{% endif %} banner--n-placeholder"
			style=""
		>
			{{
				index_0
				| modulo: 6
				| plus: 1
				| prepend: '-'
				| prepend: 'product'
				| placeholder_svg_tag: 'banner__placeholder'
			}}
		</div>
	{% endif -%}
{%- endcapture %}
{% capture capture_card %}
	<div class="card {% if settings.product_card_card_style == 'card' %}card--full{% endif %} color-scheme-{{ settings.product_card_color_scheme.id }} {% if settings.product_card_center_text %}card--center{% endif %} product-card">
		{% if card_product.url != blank -%}
			<a class="stretched-link" href="{{ card_product.url }}" aria-label="{{ card_product.title }}"> </a>
		{%- endif %}
		<div class="card__media">
			{% if settings.product_card_enable_quick_buy and card_product.available %}
				<div class="product-card__quick-view mobile-hidden">
					{% if card_product.has_only_default_variant -%}
						<x-add-to-cart class="add-to-cart" variant-id="{{ card_product.first_available_variant.id }}">
							<button style class="button button--size--sm button--drop-shadow" data-add-button>
								{{ 'products.product.add_to_cart' | t }}
								<div class="spinner button__spinner" style="--spinner-color: currentColor;">
									<div class="spinner__part"></div>
									<div class="spinner__part"></div>
									<div class="spinner__part"></div>
								</div>
							</button>
						</x-add-to-cart>
						<script type="module" src="{{ 'component-add-to-cart.js' | asset_url }}"></script>
					{% else -%}
						<x-modal
							class="modal"
							id="{{ card_product.handle | prepend: 'quick-view-modal' }}"
							url="{{ card_product.url | split: '?' | first }}"
							url-section="product-quick-view"
							style=""
						>
							<dialog class="modal__dialog" data-modal-element="dialog">
								<div class="modal__content" data-modal-element="content"></div>
							</dialog>
						</x-modal>

						<x-modal-trigger class="modal-trigger" target-id="{{ card_product.handle | prepend: 'quick-view-modal' }}">
							<button style class="button button--size--sm button--drop-shadow" data-loader-button>
								{{ 'products.product.choose_options' | t }}
								<div class="spinner button__spinner" style="--spinner-color: currentColor;">
									<div class="spinner__part"></div>
									<div class="spinner__part"></div>
									<div class="spinner__part"></div>
								</div>
							</button>
						</x-modal-trigger>
					{%- endif %}
				</div>
			{% endif %}
			{% if gyro_effect and settings.product_card_card_style != 'card' %}
				<div class="mouse-tracker__stage mouse-tracker__stage--outer">
					<div class="mouse-tracker__stage__inner">
						{{ capture_card_media }}
					</div>

					{% if outer_stage %}<div class="mouse-tracker__shadow"></div>{% endif %}
				</div>
			{% else -%}
				{{- capture_card_media -}}
			{%- endif %}
		</div>
		<div class="card__caption">
			{% if settings.product_card_show_color_swatches -%}
				{%- assign i_swatch = 0 -%}
				{%- capture capture_color_swatches -%}
					{%- for option in card_product.options_with_values -%}
						{%- if i_swatch == 5 %}{% break %}{% endif -%}
						{%- for option_value in option.values -%}
							{%- if i_swatch == 5 %}{% break %}{% endif -%}
							{%- if option_value.swatch -%}
								<span class="swatch" style="--swatch-size: 13;">
									<span
										class="swatch__bg"
										style="background: {% if option_value.swatch.image %}url({{ option_value.swatch.image | image_url: width: 26 }}){% else %}{{ option_value.swatch.color }}{% endif %};"
									></span>
								</span>
							{%- endif -%}
							{%- assign i_swatch = i_swatch | plus: 1 -%}
						{%- endfor -%}
					{%- endfor -%}
				{%- endcapture -%}
				{%- if capture_color_swatches != blank %}
					<div class="product-card__swatches {% if settings.product_card_center_text %}product-card__swatches--center{% endif %}">
						{{ capture_color_swatches }}
					</div>
				{% endif -%}
			{%- endif -%}
			{%- if settings.product_card_show_rating -%}
				{%- if card_product.metafields.reviews.rating.value.rating != blank %}
					<div class="star-rating product-card__rating {% if settings.product_card_center_text %}product-card__rating--centered{% endif %} star-rating--spaced {% if settings.colors_yellow_starrating %}star-rating--colored{% endif %}">
						<div class="star-rating__stars">
							{% assign product_rating = card_product.metafields.reviews.rating.value.rating -%}
							{%- for i in (0..4) %}
								<div class="star-rating__icon" style="--star-rating-offset: {{ product_rating }};">
									<span class="star-rating__icon-front"></span>
									<span class="star-rating__icon-back"></span>
								</div>
								{% assign product_rating = product_rating | minus: 1 -%}
							{%- endfor %}
						</div>

						{% if card_product.metafields.reviews.rating_count != blank %}
							<div class="star-rating__counter">({{ card_product.metafields.reviews.rating_count }})</div>
						{% endif %}
					</div>
				{% endif -%}
			{%- endif -%}
			{%- if settings.product_card_show_vendor %}
				<p class="product-card__vendor">{{ card_product.vendor }}</p>
			{% endif %}






{% if card_product.tags contains 'Porfollio' %}

<style>
.project-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  font-family: inherit;
  flex-wrap: wrap;
  width: 100%;
}

/* Badge Mission */
.project-meta__mission {
  font-size: 12px;
  font-weight: 600;
  padding: 3px 8px;
  border: 1px solid currentColor;
  border-radius: 6px;
  line-height: 1.1;
  white-space: normal;
  word-wrap: break-word;
  max-width: 100%;
  text-align: left;
}

/* Secteur + Année */
.project-meta__details {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px; /* garde un bel espacement général */
  font-size: 14px;
  font-weight: 500;
  color: #444;
  flex-wrap: wrap;
  width: 100%;
  text-align: left;
}

/* Flexibilité avant la césure pour secteur + année */
.project-meta__details span {
  hyphens: auto;
  overflow-wrap: break-word;
  word-break: normal;
  letter-spacing: 0.2px;
  padding-right: 2px;
}

/* Point séparateur — espace visuel réduit autour (on compense le gap) */
.project-meta__sep {
  color: #bbb;
  margin: 0 -5px; /* marges négatives pour resserrer avant/après le point */
}

/* Titre — Flexibilité universelle avant la césure */
.project-title {
  font-size: 20px;
  font-weight: 700;
  text-transform: uppercase;
  margin: 6px 0 2px;
  text-align: left !important;
  hyphens: auto;
  overflow-wrap: break-word;
  word-break: normal;
  letter-spacing: 0.2px;
  padding-right: 2px;
}

/* ================================== */
/*             RESPONSIVE             */
/* ================================== */

/* Tablette */
@media (max-width: 768px) {
  .project-title {
    font-size: 18px;
  }
  .project-meta__mission {
    font-size: 11px;
  }
  .project-meta__details {
    font-size: 13px;
  }
}

/* Mobile */
@media (max-width: 480px) {
  .project-title {
    font-size: 16px;
  }

  .project-meta__mission {
    font-size: 10px;
    padding: 2px 6px;
  }

  .project-meta__details {
    font-size: 1x;
    align-items: flex-start;
    gap: 4px;
  }

  /* Sur mobile, on masque le span du point et on recrée le séparateur avant l’année */
  .project-meta__sep {
    display: none;
  }
  .project-meta__details span + .project-meta__year::before {
    content: "•";
    margin: 0 2px; /* petit espace avant/après le point sur mobile */
    color: #bbb;
  }
}
.mobile-only { display: none; }
.desktop-only { display: inline; }

@media (max-width: 760px) {
  .mobile-only { display: inline; }
  .desktop-only { display: none; }
}

</style>




{% assign mission = card_product.metafields.custom.toutes_les_infos_sur_notre_travail.value.type_de_mission_resume_en_2_3_mots.value %}
{% assign sector = card_product.metafields.custom.toutes_les_infos_sur_ce_projet.value.secteur_d_activite_en_3_mots_max.value %}
{% assign year   = card_product.metafields.custom.toutes_les_infos_sur_notre_travail.value.anneedu_projet.value %}

{% if mission == 'DÉVELOPPEMENT SUR MESURE' %}
  {% assign mission_short = 'DÉV SUR MESURE' %}
{% else %}
  {% assign mission_short = mission %}
{% endif %}

{% if mission != blank %}
  <div class="project-meta">
    <span class="project-meta__mission desktop-only">{{ mission }}</span>
    <span class="project-meta__mission mobile-only">{{ mission_short }}</span>
  </div>
{% endif %}

<h2 class="card__heading project-title">{{ card_product.title | escape }}</h2>

{% if sector != blank or year != blank %}
  <div class="project-meta__details">
    {% if sector != blank %}<span>{{ sector }}</span>{% endif %}
    {% if sector != blank and year != blank %}<span class="project-meta__sep">•</span>{% endif %}
    {% if year != blank %}<span>{{ year }}</span>{% endif %}
  </div>
{% endif %}

{% else %}

<h2
  class="card__heading {% if settings.product_card_truncate_titles != 'none' %}card__heading--truncate{% endif %}"
  style="--card-heading-max-lines: {{ settings.product_card_truncate_titles }};"
>
  {{ card_product.title | escape }}
</h2>

{% render 'price', class: 'product-card__price', src: card_product, center: settings.product_card_center_text %}

{% endif %}












		</div>
	</div>
{% endcapture %}
{% if gyro_effect -%}
	<x-mouse-tracker class="mouse-tracker mouse-tracker--outer mouse-tracker--full" style="--mouse-tracker-z: 20px;">
		{% if settings.product_card_card_style != 'card' -%}
			{{- capture_card -}}
		{%- else %}
			<div class="mouse-tracker__stage mouse-tracker__stage--outer">
				<div class="mouse-tracker__stage__inner">
					{{ capture_card }}
				</div>

				{% if outer_stage %}<div class="mouse-tracker__shadow"></div>{% endif %}
			</div>
		{% endif %}
	</x-mouse-tracker>
{%- else -%}
	{{- capture_card -}}
{%- endif %}
